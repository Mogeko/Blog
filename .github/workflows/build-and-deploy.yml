name: Build & Deploy
on: [push, pull_request]

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@master
      with:
          submodules: true
    - name: Build
      uses: chabad360/hugo-actions@master
    - name: Deploy
      run:
      - cd ./public
      - git init
      - git config user.name "$USER_NAME"
      - git config user.email "$USER_EMAIL"
      - git add .
      - git commit -m "Update Blog By GitHub Actions With Build $GITHUB_RUN_ID"
      - git push --force --quiet "https://$DEPOLY_TOKEN@$GH_REF" master:master
      env:
      - DEPOLY_TOKEN: ${{ secrets.DEPOLY_TOKEN }}
      - GH_REF: github.com/Mogeko/mogeko.github.io
      - USER_NAME: Mogeko
      - USER_EMAIL: zhengjunyi@live.com

